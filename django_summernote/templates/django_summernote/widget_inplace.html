<script>
var src = window.document.getElementById('{{ id }}');
$(src).summernote({
    height: {{ height }},
    toolbar: {{ toolbar|safe }},
    lang: '{{ lang }}',
    onblur: function() {
        src.value = $(this).code();
    },
    onImageUpload: function(files, editor, position) {
        var imageInput = $('.note-image-input');
        imageInput.fileupload();
        var jqXHR = imageInput.fileupload('send', 
            {
                files: files,
                formData: {csrfmiddlewaretoken: '{{ csrf_token }}'},
                url: '{{ url.upload_attachment }}',
            })
            .success(function (result, textStatus, jqXHR) {
                data = $.parseJSON(result);
                $.each(data.files, function (index, file) {
                    editor.insertImage(position, file.url);
                });
            })
            .error(function (jqXHR, textStatus, errorThrown) {
                // TODO: Display a detailed error message. It will come from JSON.
                alert( 'Got an error while uploading images.' );
            })
        }
});
</script>
